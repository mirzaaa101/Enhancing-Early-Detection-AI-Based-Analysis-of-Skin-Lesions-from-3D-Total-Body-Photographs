{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "3504790a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-02T04:06:53.995039Z",
     "iopub.status.busy": "2024-08-02T04:06:53.994632Z",
     "iopub.status.idle": "2024-08-02T04:07:01.858369Z",
     "shell.execute_reply": "2024-08-02T04:07:01.857242Z"
    },
    "papermill": {
     "duration": 7.870993,
     "end_time": "2024-08-02T04:07:01.860721",
     "exception": false,
     "start_time": "2024-08-02T04:06:53.989728",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/tmp/ipykernel_18/335192879.py:3: DtypeWarning: Columns (51,52) have mixed types. Specify dtype option on import or set low_memory=False.\n",
      "  df = pd.read_csv(\"/kaggle/input/isic-2024-challenge/train-metadata.csv\")\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>isic_id</th>\n",
       "      <th>target</th>\n",
       "      <th>patient_id</th>\n",
       "      <th>age_approx</th>\n",
       "      <th>sex</th>\n",
       "      <th>anatom_site_general</th>\n",
       "      <th>clin_size_long_diam_mm</th>\n",
       "      <th>image_type</th>\n",
       "      <th>tbp_tile_type</th>\n",
       "      <th>tbp_lv_A</th>\n",
       "      <th>...</th>\n",
       "      <th>lesion_id</th>\n",
       "      <th>iddx_full</th>\n",
       "      <th>iddx_1</th>\n",
       "      <th>iddx_2</th>\n",
       "      <th>iddx_3</th>\n",
       "      <th>iddx_4</th>\n",
       "      <th>iddx_5</th>\n",
       "      <th>mel_mitotic_index</th>\n",
       "      <th>mel_thick_mm</th>\n",
       "      <th>tbp_lv_dnn_lesion_confidence</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>ISIC_0015670</td>\n",
       "      <td>0</td>\n",
       "      <td>IP_1235828</td>\n",
       "      <td>60.0</td>\n",
       "      <td>male</td>\n",
       "      <td>lower extremity</td>\n",
       "      <td>3.04</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: white</td>\n",
       "      <td>20.244422</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Benign</td>\n",
       "      <td>Benign</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>97.517282</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>ISIC_0015845</td>\n",
       "      <td>0</td>\n",
       "      <td>IP_8170065</td>\n",
       "      <td>60.0</td>\n",
       "      <td>male</td>\n",
       "      <td>head/neck</td>\n",
       "      <td>1.10</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: white</td>\n",
       "      <td>31.712570</td>\n",
       "      <td>...</td>\n",
       "      <td>IL_6727506</td>\n",
       "      <td>Benign</td>\n",
       "      <td>Benign</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>3.141455</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>ISIC_0015864</td>\n",
       "      <td>0</td>\n",
       "      <td>IP_6724798</td>\n",
       "      <td>60.0</td>\n",
       "      <td>male</td>\n",
       "      <td>posterior torso</td>\n",
       "      <td>3.40</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: XP</td>\n",
       "      <td>22.575830</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Benign</td>\n",
       "      <td>Benign</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>99.804040</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>ISIC_0015902</td>\n",
       "      <td>0</td>\n",
       "      <td>IP_4111386</td>\n",
       "      <td>65.0</td>\n",
       "      <td>male</td>\n",
       "      <td>anterior torso</td>\n",
       "      <td>3.22</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: XP</td>\n",
       "      <td>14.242329</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Benign</td>\n",
       "      <td>Benign</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>99.989998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>ISIC_0024200</td>\n",
       "      <td>0</td>\n",
       "      <td>IP_8313778</td>\n",
       "      <td>55.0</td>\n",
       "      <td>male</td>\n",
       "      <td>anterior torso</td>\n",
       "      <td>2.73</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: white</td>\n",
       "      <td>24.725520</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Benign</td>\n",
       "      <td>Benign</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>70.442510</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 55 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        isic_id  target  patient_id  age_approx   sex anatom_site_general  \\\n",
       "0  ISIC_0015670       0  IP_1235828        60.0  male     lower extremity   \n",
       "1  ISIC_0015845       0  IP_8170065        60.0  male           head/neck   \n",
       "2  ISIC_0015864       0  IP_6724798        60.0  male     posterior torso   \n",
       "3  ISIC_0015902       0  IP_4111386        65.0  male      anterior torso   \n",
       "4  ISIC_0024200       0  IP_8313778        55.0  male      anterior torso   \n",
       "\n",
       "   clin_size_long_diam_mm          image_type tbp_tile_type   tbp_lv_A  ...  \\\n",
       "0                    3.04  TBP tile: close-up     3D: white  20.244422  ...   \n",
       "1                    1.10  TBP tile: close-up     3D: white  31.712570  ...   \n",
       "2                    3.40  TBP tile: close-up        3D: XP  22.575830  ...   \n",
       "3                    3.22  TBP tile: close-up        3D: XP  14.242329  ...   \n",
       "4                    2.73  TBP tile: close-up     3D: white  24.725520  ...   \n",
       "\n",
       "    lesion_id  iddx_full  iddx_1  iddx_2  iddx_3  iddx_4  iddx_5  \\\n",
       "0         NaN     Benign  Benign     NaN     NaN     NaN     NaN   \n",
       "1  IL_6727506     Benign  Benign     NaN     NaN     NaN     NaN   \n",
       "2         NaN     Benign  Benign     NaN     NaN     NaN     NaN   \n",
       "3         NaN     Benign  Benign     NaN     NaN     NaN     NaN   \n",
       "4         NaN     Benign  Benign     NaN     NaN     NaN     NaN   \n",
       "\n",
       "   mel_mitotic_index  mel_thick_mm  tbp_lv_dnn_lesion_confidence  \n",
       "0                NaN           NaN                     97.517282  \n",
       "1                NaN           NaN                      3.141455  \n",
       "2                NaN           NaN                     99.804040  \n",
       "3                NaN           NaN                     99.989998  \n",
       "4                NaN           NaN                     70.442510  \n",
       "\n",
       "[5 rows x 55 columns]"
      ]
     },
     "execution_count": 1,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import pandas as pd\n",
    "\n",
    "df = pd.read_csv(\"/kaggle/input/isic-2024-challenge/train-metadata.csv\")\n",
    "df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "391ba972",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-02T04:07:01.868834Z",
     "iopub.status.busy": "2024-08-02T04:07:01.868481Z",
     "iopub.status.idle": "2024-08-02T04:07:01.887216Z",
     "shell.execute_reply": "2024-08-02T04:07:01.886089Z"
    },
    "papermill": {
     "duration": 0.025335,
     "end_time": "2024-08-02T04:07:01.889530",
     "exception": false,
     "start_time": "2024-08-02T04:07:01.864195",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "target\n",
       "0    400666\n",
       "1       393\n",
       "Name: count, dtype: int64"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df[\"target\"].value_counts()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "24ffebd1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-02T04:07:01.897945Z",
     "iopub.status.busy": "2024-08-02T04:07:01.897590Z",
     "iopub.status.idle": "2024-08-02T04:07:02.072584Z",
     "shell.execute_reply": "2024-08-02T04:07:02.071502Z"
    },
    "papermill": {
     "duration": 0.182009,
     "end_time": "2024-08-02T04:07:02.074982",
     "exception": false,
     "start_time": "2024-08-02T04:07:01.892973",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "target\n",
      "0    1000\n",
      "1     393\n",
      "Name: count, dtype: int64\n"
     ]
    }
   ],
   "source": [
    "class_0 = df[df[\"target\"] == 0]\n",
    "class_1 = df[df[\"target\"] == 1]\n",
    "\n",
    "\n",
    "sampled_class_0 = class_0.sample(n=1000, random_state=42)\n",
    "sampled_class_1 = class_1.sample(n=393, random_state=42)\n",
    "\n",
    "balanced_df = pd.concat([sampled_class_0, sampled_class_1])\n",
    "\n",
    "balanced_df = balanced_df.sample(frac=1, random_state=42).reset_index(drop=True)\n",
    "print(balanced_df[\"target\"].value_counts())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "caec8056",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-02T04:07:02.083448Z",
     "iopub.status.busy": "2024-08-02T04:07:02.083051Z",
     "iopub.status.idle": "2024-08-02T04:07:02.113602Z",
     "shell.execute_reply": "2024-08-02T04:07:02.112603Z"
    },
    "papermill": {
     "duration": 0.037516,
     "end_time": "2024-08-02T04:07:02.115931",
     "exception": false,
     "start_time": "2024-08-02T04:07:02.078415",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>isic_id</th>\n",
       "      <th>target</th>\n",
       "      <th>patient_id</th>\n",
       "      <th>age_approx</th>\n",
       "      <th>sex</th>\n",
       "      <th>anatom_site_general</th>\n",
       "      <th>clin_size_long_diam_mm</th>\n",
       "      <th>image_type</th>\n",
       "      <th>tbp_tile_type</th>\n",
       "      <th>tbp_lv_A</th>\n",
       "      <th>...</th>\n",
       "      <th>lesion_id</th>\n",
       "      <th>iddx_full</th>\n",
       "      <th>iddx_1</th>\n",
       "      <th>iddx_2</th>\n",
       "      <th>iddx_3</th>\n",
       "      <th>iddx_4</th>\n",
       "      <th>iddx_5</th>\n",
       "      <th>mel_mitotic_index</th>\n",
       "      <th>mel_thick_mm</th>\n",
       "      <th>tbp_lv_dnn_lesion_confidence</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>ISIC_8774025</td>\n",
       "      <td>0</td>\n",
       "      <td>IP_5536173</td>\n",
       "      <td>75.0</td>\n",
       "      <td>male</td>\n",
       "      <td>head/neck</td>\n",
       "      <td>4.23</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: XP</td>\n",
       "      <td>19.280050</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Benign</td>\n",
       "      <td>Benign</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>95.70935</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>ISIC_9972877</td>\n",
       "      <td>1</td>\n",
       "      <td>IP_8877928</td>\n",
       "      <td>65.0</td>\n",
       "      <td>female</td>\n",
       "      <td>lower extremity</td>\n",
       "      <td>12.08</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: white</td>\n",
       "      <td>23.465230</td>\n",
       "      <td>...</td>\n",
       "      <td>IL_7206529</td>\n",
       "      <td>Malignant::Malignant melanocytic proliferation...</td>\n",
       "      <td>Malignant</td>\n",
       "      <td>Malignant melanocytic proliferations (Melanoma)</td>\n",
       "      <td>Melanoma Invasive</td>\n",
       "      <td>Melanoma Invasive, Superficial spreading</td>\n",
       "      <td>NaN</td>\n",
       "      <td>&lt;1/mm^2</td>\n",
       "      <td>0.6</td>\n",
       "      <td>99.78669</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>ISIC_0967659</td>\n",
       "      <td>0</td>\n",
       "      <td>IP_5726814</td>\n",
       "      <td>40.0</td>\n",
       "      <td>female</td>\n",
       "      <td>posterior torso</td>\n",
       "      <td>3.12</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: XP</td>\n",
       "      <td>20.068190</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Benign</td>\n",
       "      <td>Benign</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>100.00000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>ISIC_6623310</td>\n",
       "      <td>0</td>\n",
       "      <td>IP_9027701</td>\n",
       "      <td>50.0</td>\n",
       "      <td>male</td>\n",
       "      <td>anterior torso</td>\n",
       "      <td>2.62</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: white</td>\n",
       "      <td>17.842650</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Benign</td>\n",
       "      <td>Benign</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>99.12086</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>ISIC_0420491</td>\n",
       "      <td>0</td>\n",
       "      <td>IP_6070270</td>\n",
       "      <td>65.0</td>\n",
       "      <td>male</td>\n",
       "      <td>anterior torso</td>\n",
       "      <td>5.62</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: white</td>\n",
       "      <td>15.423770</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Benign</td>\n",
       "      <td>Benign</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>99.99990</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1388</th>\n",
       "      <td>ISIC_5359616</td>\n",
       "      <td>1</td>\n",
       "      <td>IP_5536173</td>\n",
       "      <td>75.0</td>\n",
       "      <td>male</td>\n",
       "      <td>lower extremity</td>\n",
       "      <td>4.94</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: XP</td>\n",
       "      <td>10.552610</td>\n",
       "      <td>...</td>\n",
       "      <td>IL_7056796</td>\n",
       "      <td>Malignant::Malignant adnexal epithelial prolif...</td>\n",
       "      <td>Malignant</td>\n",
       "      <td>Malignant adnexal epithelial proliferations - ...</td>\n",
       "      <td>Basal cell carcinoma</td>\n",
       "      <td>Basal cell carcinoma, Superficial</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>99.90940</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1389</th>\n",
       "      <td>ISIC_9060519</td>\n",
       "      <td>1</td>\n",
       "      <td>IP_6774617</td>\n",
       "      <td>70.0</td>\n",
       "      <td>male</td>\n",
       "      <td>anterior torso</td>\n",
       "      <td>3.18</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: XP</td>\n",
       "      <td>26.248790</td>\n",
       "      <td>...</td>\n",
       "      <td>IL_7464223</td>\n",
       "      <td>Malignant::Malignant adnexal epithelial prolif...</td>\n",
       "      <td>Malignant</td>\n",
       "      <td>Malignant adnexal epithelial proliferations - ...</td>\n",
       "      <td>Basal cell carcinoma</td>\n",
       "      <td>Basal cell carcinoma, Superficial</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>88.16375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1390</th>\n",
       "      <td>ISIC_6397037</td>\n",
       "      <td>1</td>\n",
       "      <td>IP_8925663</td>\n",
       "      <td>30.0</td>\n",
       "      <td>female</td>\n",
       "      <td>anterior torso</td>\n",
       "      <td>8.19</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: XP</td>\n",
       "      <td>20.858070</td>\n",
       "      <td>...</td>\n",
       "      <td>IL_9129997</td>\n",
       "      <td>Malignant::Malignant melanocytic proliferation...</td>\n",
       "      <td>Malignant</td>\n",
       "      <td>Malignant melanocytic proliferations (Melanoma)</td>\n",
       "      <td>Melanoma Invasive</td>\n",
       "      <td>Melanoma Invasive, Superficial spreading</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.6</td>\n",
       "      <td>99.99983</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1391</th>\n",
       "      <td>ISIC_1208434</td>\n",
       "      <td>0</td>\n",
       "      <td>IP_4849578</td>\n",
       "      <td>50.0</td>\n",
       "      <td>female</td>\n",
       "      <td>anterior torso</td>\n",
       "      <td>5.62</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: XP</td>\n",
       "      <td>19.803525</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Benign</td>\n",
       "      <td>Benign</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>100.00000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1392</th>\n",
       "      <td>ISIC_5042859</td>\n",
       "      <td>1</td>\n",
       "      <td>IP_5516884</td>\n",
       "      <td>60.0</td>\n",
       "      <td>male</td>\n",
       "      <td>anterior torso</td>\n",
       "      <td>7.31</td>\n",
       "      <td>TBP tile: close-up</td>\n",
       "      <td>3D: XP</td>\n",
       "      <td>21.947240</td>\n",
       "      <td>...</td>\n",
       "      <td>IL_4424739</td>\n",
       "      <td>Malignant::Malignant melanocytic proliferation...</td>\n",
       "      <td>Malignant</td>\n",
       "      <td>Malignant melanocytic proliferations (Melanoma)</td>\n",
       "      <td>Melanoma in situ</td>\n",
       "      <td>Melanoma in situ, associated with a nevus</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>99.99999</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>1393 rows × 55 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "           isic_id  target  patient_id  age_approx     sex  \\\n",
       "0     ISIC_8774025       0  IP_5536173        75.0    male   \n",
       "1     ISIC_9972877       1  IP_8877928        65.0  female   \n",
       "2     ISIC_0967659       0  IP_5726814        40.0  female   \n",
       "3     ISIC_6623310       0  IP_9027701        50.0    male   \n",
       "4     ISIC_0420491       0  IP_6070270        65.0    male   \n",
       "...            ...     ...         ...         ...     ...   \n",
       "1388  ISIC_5359616       1  IP_5536173        75.0    male   \n",
       "1389  ISIC_9060519       1  IP_6774617        70.0    male   \n",
       "1390  ISIC_6397037       1  IP_8925663        30.0  female   \n",
       "1391  ISIC_1208434       0  IP_4849578        50.0  female   \n",
       "1392  ISIC_5042859       1  IP_5516884        60.0    male   \n",
       "\n",
       "     anatom_site_general  clin_size_long_diam_mm          image_type  \\\n",
       "0              head/neck                    4.23  TBP tile: close-up   \n",
       "1        lower extremity                   12.08  TBP tile: close-up   \n",
       "2        posterior torso                    3.12  TBP tile: close-up   \n",
       "3         anterior torso                    2.62  TBP tile: close-up   \n",
       "4         anterior torso                    5.62  TBP tile: close-up   \n",
       "...                  ...                     ...                 ...   \n",
       "1388     lower extremity                    4.94  TBP tile: close-up   \n",
       "1389      anterior torso                    3.18  TBP tile: close-up   \n",
       "1390      anterior torso                    8.19  TBP tile: close-up   \n",
       "1391      anterior torso                    5.62  TBP tile: close-up   \n",
       "1392      anterior torso                    7.31  TBP tile: close-up   \n",
       "\n",
       "     tbp_tile_type   tbp_lv_A  ...   lesion_id  \\\n",
       "0           3D: XP  19.280050  ...         NaN   \n",
       "1        3D: white  23.465230  ...  IL_7206529   \n",
       "2           3D: XP  20.068190  ...         NaN   \n",
       "3        3D: white  17.842650  ...         NaN   \n",
       "4        3D: white  15.423770  ...         NaN   \n",
       "...            ...        ...  ...         ...   \n",
       "1388        3D: XP  10.552610  ...  IL_7056796   \n",
       "1389        3D: XP  26.248790  ...  IL_7464223   \n",
       "1390        3D: XP  20.858070  ...  IL_9129997   \n",
       "1391        3D: XP  19.803525  ...         NaN   \n",
       "1392        3D: XP  21.947240  ...  IL_4424739   \n",
       "\n",
       "                                              iddx_full     iddx_1  \\\n",
       "0                                                Benign     Benign   \n",
       "1     Malignant::Malignant melanocytic proliferation...  Malignant   \n",
       "2                                                Benign     Benign   \n",
       "3                                                Benign     Benign   \n",
       "4                                                Benign     Benign   \n",
       "...                                                 ...        ...   \n",
       "1388  Malignant::Malignant adnexal epithelial prolif...  Malignant   \n",
       "1389  Malignant::Malignant adnexal epithelial prolif...  Malignant   \n",
       "1390  Malignant::Malignant melanocytic proliferation...  Malignant   \n",
       "1391                                             Benign     Benign   \n",
       "1392  Malignant::Malignant melanocytic proliferation...  Malignant   \n",
       "\n",
       "                                                 iddx_2                iddx_3  \\\n",
       "0                                                   NaN                   NaN   \n",
       "1       Malignant melanocytic proliferations (Melanoma)     Melanoma Invasive   \n",
       "2                                                   NaN                   NaN   \n",
       "3                                                   NaN                   NaN   \n",
       "4                                                   NaN                   NaN   \n",
       "...                                                 ...                   ...   \n",
       "1388  Malignant adnexal epithelial proliferations - ...  Basal cell carcinoma   \n",
       "1389  Malignant adnexal epithelial proliferations - ...  Basal cell carcinoma   \n",
       "1390    Malignant melanocytic proliferations (Melanoma)     Melanoma Invasive   \n",
       "1391                                                NaN                   NaN   \n",
       "1392    Malignant melanocytic proliferations (Melanoma)      Melanoma in situ   \n",
       "\n",
       "                                         iddx_4  iddx_5  mel_mitotic_index  \\\n",
       "0                                           NaN     NaN                NaN   \n",
       "1      Melanoma Invasive, Superficial spreading     NaN            <1/mm^2   \n",
       "2                                           NaN     NaN                NaN   \n",
       "3                                           NaN     NaN                NaN   \n",
       "4                                           NaN     NaN                NaN   \n",
       "...                                         ...     ...                ...   \n",
       "1388          Basal cell carcinoma, Superficial     NaN                NaN   \n",
       "1389          Basal cell carcinoma, Superficial     NaN                NaN   \n",
       "1390   Melanoma Invasive, Superficial spreading     NaN                NaN   \n",
       "1391                                        NaN     NaN                NaN   \n",
       "1392  Melanoma in situ, associated with a nevus     NaN                NaN   \n",
       "\n",
       "      mel_thick_mm  tbp_lv_dnn_lesion_confidence  \n",
       "0              NaN                      95.70935  \n",
       "1              0.6                      99.78669  \n",
       "2              NaN                     100.00000  \n",
       "3              NaN                      99.12086  \n",
       "4              NaN                      99.99990  \n",
       "...            ...                           ...  \n",
       "1388           NaN                      99.90940  \n",
       "1389           NaN                      88.16375  \n",
       "1390           0.6                      99.99983  \n",
       "1391           NaN                     100.00000  \n",
       "1392           NaN                      99.99999  \n",
       "\n",
       "[1393 rows x 55 columns]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "balanced_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "42b4b8dc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-02T04:07:02.125922Z",
     "iopub.status.busy": "2024-08-02T04:07:02.125179Z",
     "iopub.status.idle": "2024-08-02T04:07:02.131159Z",
     "shell.execute_reply": "2024-08-02T04:07:02.130046Z"
    },
    "papermill": {
     "duration": 0.013522,
     "end_time": "2024-08-02T04:07:02.133514",
     "exception": false,
     "start_time": "2024-08-02T04:07:02.119992",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "from PIL import Image\n",
    "import os\n",
    "\n",
    "image_dir = '/kaggle/input/isic-2024-challenge/train-image/image'\n",
    "\n",
    "\n",
    "def load_image(image_id, image_dir):\n",
    "    image_path = os.path.join(image_dir, f\"{image_id}.jpg\")\n",
    "    image = Image.open(image_path)\n",
    "    return image"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "8f100824",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-02T04:07:02.143329Z",
     "iopub.status.busy": "2024-08-02T04:07:02.142901Z",
     "iopub.status.idle": "2024-08-02T04:07:08.171242Z",
     "shell.execute_reply": "2024-08-02T04:07:08.170093Z"
    },
    "papermill": {
     "duration": 6.036185,
     "end_time": "2024-08-02T04:07:08.173772",
     "exception": false,
     "start_time": "2024-08-02T04:07:02.137587",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Loaded 1393 images with 1393 labels.\n"
     ]
    }
   ],
   "source": [
    "images = []\n",
    "labels = []\n",
    "\n",
    "for _, row in balanced_df.iterrows():\n",
    "    image_id = row['isic_id']\n",
    "    label = row['target']\n",
    "    image = load_image(image_id, image_dir)\n",
    "    images.append(image)\n",
    "    labels.append(label)\n",
    "\n",
    "print(f\"Loaded {len(images)} images with {len(labels)} labels.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "1bf68f1e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-02T04:07:08.184118Z",
     "iopub.status.busy": "2024-08-02T04:07:08.183113Z",
     "iopub.status.idle": "2024-08-02T04:07:09.950789Z",
     "shell.execute_reply": "2024-08-02T04:07:09.949753Z"
    },
    "papermill": {
     "duration": 1.77648,
     "end_time": "2024-08-02T04:07:09.954276",
     "exception": false,
     "start_time": "2024-08-02T04:07:08.177796",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Dataset saved and zipped at /kaggle/working/isic_balanced_dataset.zip\n"
     ]
    }
   ],
   "source": [
    "import shutil\n",
    "\n",
    "\n",
    "output_dir = '/kaggle/working/isic_balanced_dataset'\n",
    "os.makedirs(output_dir, exist_ok=True)\n",
    "\n",
    "\n",
    "image_output_dir = os.path.join(output_dir, 'images')\n",
    "os.makedirs(image_output_dir, exist_ok=True)\n",
    "\n",
    "\n",
    "image_paths = []\n",
    "for i, (image, label) in enumerate(zip(images, labels)):\n",
    "    image_id = balanced_df.iloc[i]['isic_id']\n",
    "    image_path = os.path.join(image_output_dir, f\"{image_id}.jpg\")\n",
    "    image.save(image_path)\n",
    "    image_paths.append(image_path)\n",
    "\n",
    "\n",
    "labels_df = balanced_df[['isic_id', 'target']]\n",
    "labels_df.to_csv(os.path.join(output_dir, 'labels.csv'), index=False)\n",
    "\n",
    "\n",
    "shutil.make_archive('/kaggle/working/isic_balanced_dataset', 'zip', output_dir)\n",
    "print(f\"Dataset saved and zipped at /kaggle/working/isic_balanced_dataset.zip\")"
   ]
  }
 ],
 "metadata": {
  "kaggle": {
   "accelerator": "none",
   "dataSources": [
    {
     "databundleVersionId": 9094797,
     "sourceId": 63056,
     "sourceType": "competition"
    }
   ],
   "dockerImageVersionId": 30732,
   "isGpuEnabled": false,
   "isInternetEnabled": true,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.13"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 19.269066,
   "end_time": "2024-08-02T04:07:10.479876",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2024-08-02T04:06:51.210810",
   "version": "2.5.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
